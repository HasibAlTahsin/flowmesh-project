global:
  scrape_interval: 15s  # Scrape every 15 seconds
  evaluation_interval: 15s  # Evaluate rules every 15 seconds

# Alertmanager configuration
alerting:
  alertmanagers:
    - static_configs:
        - targets:
            - 'localhost:9093'  # Alertmanager endpoint

# Scrape configuration for Prometheus
scrape_configs:
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']

  # Example of scraping a service, replace with your own services
  - job_name: 'user-service'
    static_configs:
      - targets: ['localhost:3000']

  - job_name: 'product-service'
    static_configs:
      - targets: ['localhost:3006']

  - job_name: 'order-service'
    static_configs:
      - targets: ['localhost:3002']

  - job_name: 'payment-service'
    static_configs:
      - targets: ['localhost:3003']

  - job_name: 'inventory-service'
    static_configs:
      - targets: ['localhost:3004']

  - job_name: 'notification-service'
    static_configs:
      - targets: ['localhost:3005']

  - job_name: 'mongo'
    static_configs:
      - targets: ['localhost:27018']

# Alerting Rules Configuration
rule_files:
  - "alert.rules.yml"

# An example alert rule file
alert_rules:
  groups:
    - name: example
      rules:
        - alert: HighCPUUsage
          expr: avg(rate(process_cpu_seconds_total[5m])) by (instance) > 0.85
          for: 5m
          labels:
            severity: critical
          annotations:
            summary: "CPU usage is above 85% for more than 5 minutes"
            description: "Instance {{ $labels.instance }} has been using more than 85% CPU for the last 5 minutes."

# Metrics server settings
metric_relabel_configs:
  - source_labels: [__name__]
    target_label: job
    replacement: 'prometheus'

# Scraping additional sources
remote_write:
  - url: 'http://localhost:9000/write'  # For remote storage (e.g., Thanos, Cortex, etc.)
  
# Logging configuration (optional)
log_level: info
